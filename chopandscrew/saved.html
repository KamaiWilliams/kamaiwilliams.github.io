<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>chop& screw â€” saved loops</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://use.typekit.net/afn8srh.css">
</head>
<body>
  <div class="main-container">
    <!-- Top Section: Title + Measure Bar -->
    <div class="top-container">
      <div class="title-container">
        <div class="title-row">
          <!-- Clickable Home Title -->
          <a href="index.html" class="title">
            <span class="line1">chop&</span><br>
            <span class="line2">screw</span>
          </a>
          
          <!-- Measure Bar -->
          <div id="measure-bar">
            <div id="measure-fill"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Saved Loops Frame -->
    <div class="loop-frame">
      <div class="loop-content">
        <!-- Saved Loops Grid -->
        <div id="saved-loops-grid"></div>

        <!-- Control Panel -->
        <div id="control-panel">
          <button id="playSavedBtn">play</button>
          <button id="pauseSavedBtn">pause</button>
          <button id="loopPadBtn">loop pad</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // === Retrieve and Display Saved Loops ===
    const savedLoopsGrid = document.getElementById("saved-loops-grid");

    function loadSavedLoops() {
      const savedLoops = JSON.parse(localStorage.getItem("savedLoops")) || [];

      savedLoopsGrid.innerHTML = ""; // Clear existing grid

      if (savedLoops.length === 0) {
        savedLoopsGrid.innerHTML = `
          <div style="text-align:center; color:#572236; font-family:'le-havre-rounded',sans-serif; font-size:1.2rem;">
            no loops saved yet :(
          </div>`;
        return;
      }

      // Create a tile for each saved loop
      savedLoops.forEach((loop, index) => {
        const tile = document.createElement("div");
        tile.classList.add("saved-loop-tile");
        tile.innerHTML = `<span class="loop-label">${loop.name}</span>`;

        tile.addEventListener("click", () => {
          document.querySelectorAll(".saved-loop-tile").forEach(t => t.classList.remove("active"));
          tile.classList.add("active");

          // Store which loop was selected for playback
          localStorage.setItem("selectedLoopIndex", index);
          console.log("Selected loop:", loop.name);
        });

        savedLoopsGrid.appendChild(tile);
      });
    }

    // === Button: Play Saved Loop ===
    document.getElementById("playSavedBtn").addEventListener("click", () => {
      const savedLoops = JSON.parse(localStorage.getItem("savedLoops")) || [];
      const selectedIndex = localStorage.getItem("selectedLoopIndex");

      if (selectedIndex === null) {
        alert("select a loop to play!");
        return;
      }

      const selectedLoop = savedLoops[selectedIndex];
      if (!selectedLoop) return;

      // store the loop data temporarily for loop-pad.html
      localStorage.setItem("currentLoop", JSON.stringify(selectedLoop));
      window.location.href = "loop-pad.html";
    });

    // === Button: Pause ===
    document.getElementById("pauseSavedBtn").addEventListener("click", () => {
      console.log("Paused (to be implemented later)");
    });

    // === Button: Loop Pad (navigate back) ===
    document.getElementById("loopPadBtn").addEventListener("click", () => {
      window.location.href = "loop-pad.html";
    });

    // Load loops on page open
    loadSavedLoops();
  </script>
</body>
</html>
